{% extends 'students/base.html' %}

{% block title %}Add Student - Student Attendance System{% endblock %}

{% block content %}
<div class="card">
    <h2 style="margin-bottom: 30px; color: #333;">Add New Student</h2>
    
    <form method="post" id="student-form">
        {% csrf_token %}
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div class="form-group">
                <label for="name">Student Name *</label>
                <input type="text" id="name" name="name" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="father_name">Father's Name *</label>
                <input type="text" id="father_name" name="father_name" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="mother_name">Mother's Name *</label>
                <input type="text" id="mother_name" name="mother_name" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="student_class">Class *</label>
                <select id="student_class" name="student_class" class="form-control" required>
                    <option value="">Select Class</option>
                    {% for i in "0123456789" %}
                        <option value="{{ forloop.counter }}">Class {{ forloop.counter }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="section">Section</label>
                <input type="text" id="section" name="section" class="form-control" value="A" readonly>
                <small style="color: #666;">Each class has only one section (A)</small>
            </div>
            
            <div class="form-group">
                <label for="date_of_birth">Date of Birth *</label>
                <input type="date" id="date_of_birth" name="date_of_birth" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="contact_number">Contact Number</label>
                <input type="tel" id="contact_number" name="contact_number" class="form-control" placeholder="Enter contact number">
            </div>
        </div>
        
        <div class="form-group">
            <label for="address">Address</label>
            <textarea id="address" name="address" class="form-control" rows="3" placeholder="Enter complete address"></textarea>
        </div>
        
        <div style="display: flex; gap: 10px; margin-top: 30px;">
            <button type="submit" class="btn">Add Student</button>
            <a href="{% url 'student_list' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('student-form');
    const nameInput = document.getElementById('name');
    const fatherNameInput = document.getElementById('father_name');
    const motherNameInput = document.getElementById('mother_name');
    const dobInput = document.getElementById('date_of_birth');
    const contactInput = document.getElementById('contact_number');
    
    // Set max date for date of birth (today)
    const today = new Date().toISOString().split('T')[0];
    dobInput.max = today;
    
    // Form validation
    form.addEventListener('submit', function(e) {
        let isValid = true;
        const errors = [];
        
        // Name validation
        if (nameInput.value.trim().length < 2) {
            errors.push('Student name must be at least 2 characters long');
            isValid = false;
        }
        
        // Father's name validation
        if (fatherNameInput.value.trim().length < 2) {
            errors.push('Father\'s name must be at least 2 characters long');
            isValid = false;
        }
        
        // Mother's name validation
        if (motherNameInput.value.trim().length < 2) {
            errors.push('Mother\'s name must be at least 2 characters long');
            isValid = false;
        }
        
        // Date of birth validation
        if (dobInput.value) {
            const dob = new Date(dobInput.value);
            const today = new Date();
            const age = today.getFullYear() - dob.getFullYear();
            
            if (age < 3 || age > 25) {
                errors.push('Student age should be between 3 and 25 years');
                isValid = false;
            }
        }
        
        // Contact number validation (if provided)
        if (contactInput.value.trim() && !/^\d{10}$/.test(contactInput.value.trim())) {
            errors.push('Contact number should be 10 digits');
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
            alert('Please fix the following errors:\n\n' + errors.join('\n'));
        }
    });
    
    // Auto-format contact number
    contactInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 10) {
            value = value.slice(0, 10);
        }
        e.target.value = value;
    });
    
    // Capitalize names
    [nameInput, fatherNameInput, motherNameInput].forEach(input => {
        input.addEventListener('blur', function(e) {
            e.target.value = e.target.value.replace(/\b\w/g, l => l.toUpperCase());
        });
    });
});
</script>
{% endblock %}

